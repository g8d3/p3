# =============================================================================
# SKILLSMARKET - ENVIRONMENT VARIABLES
# =============================================================================
# Template file with all required variables and where to get each.
# Copy this to .env.local for local development.
# =============================================================================
# IMPORTANT: .env.local is in .gitignore - DO NOT commit it!

# =============================================================================
# DATABASE
# =============================================================================

# PostgreSQL Database Connection String
# How to get:

# ===== OPTION 1: Prisma Local (Easiest for development) =====
# Command: npx prisma dev
# This automatically creates a local PostgreSQL instance
# Note: The DATABASE_URL is automatically set by prisma dev
# No manual action needed!

# ===== OPTION 2: Neon (Free cloud PostgreSQL) =====
# 1. Go to: https://neon.tech
# 2. Sign up (GitHub/Google/Email)
# 3. Create new project → Name: "SkillsMarket"
# 4. Copy "Connection String" from Dashboard → Project → Connection Details
# 5. Select "Prisma" or "Node.js" format
# Example format: postgresql://username:password@ep-xxx.us-east-2.aws.neon.tech/neondb?sslmode=require

# ===== OPTION 3: Railway (Easy deployment) =====
# 1. Go to: https://railway.app
# 2. Create new project → Add PostgreSQL
# 3. Copy DATABASE_URL from Variables tab

DATABASE_URL="prisma+postgres://localhost:51213/?api_key=..."


# =============================================================================
# BETTER AUTH
# =============================================================================

# Secret key for session signing and encryption
# How to generate:
# Command (Linux/Mac): openssl rand -base64 32
# Command (Windows): openssl rand -base64 32
# Online generator: https://generate-secret.vercel.app/32
# Example output: abc123def456xyz789... (32+ characters)
AUTH_SECRET="generate-with-openssl-rand-base64-32"


# =============================================================================
# POLAR.SH PAYMENTS
# =============================================================================

# Polar.sh Access Token for API calls
# How to get:
# 1. Go to: https://polar.sh/dashboard
# 2. Sign up or login
# 3. Navigate to: Settings (gear icon) → API Keys
# 4. Click "Create API Key"
# 5. Select permissions: products:read, products:write, checkouts:write, webhooks:read, webhooks:write
# 6. Copy the token (starts with "pol_")
# 7. Keep secret! Allows charging customers.

POLAR_ACCESS_TOKEN="pol_1234567890abcdefghijklmnop"

# Polar.sh Webhook Secret for verifying webhook events
# How to get:
# 1. Go to: https://polar.sh/dashboard/your-org/settings/webhooks
# 2. Click "Create Webhook"
# 3. Webhook URL: https://your-domain.com/api/payments/polar/webhook
# 4. Events: checkout.created, checkout.completed, order.created, order.paid
# 5. After creating, click webhook → Copy "Webhook Secret"
# 6. Starts with "whsec_"

POLAR_WEBHOOK_SECRET="whsec_1234567890abcdefghijklmnop"

# Polar Mode: "sandbox" or "production"
# Sandbox: Test payments without real money
# Production: Live payments with real money
POLAR_MODE="sandbox"


# =============================================================================
# LICENSE SYSTEM
# =============================================================================

# Salt for generating and verifying license keys
# How to generate:
# Command: openssl rand -hex 16
# Online: https://www.random.org/strings/
# Example: 1a2b3c4d5e6f7g8h (32 hex characters)
LICENSE_SALT="your-random-salt-here-16-characters"


# =============================================================================
# ERC-8004 (Agent Identity & Reputation)
# =============================================================================

# Private key for ERC-8004 contract interactions
# WARNING: This can sign transactions! Use dedicated test wallet for development!

# How to get:

# ===== OPTION 1: Create New Wallet (Recommended for Testing) =====
# 1. Install wallet extension:
#    - MetaMask: https://metamask.io
#    - Coinbase Wallet: https://www.coinbase.com/wallet
#    - Rainbow: https://rainbow.me
# 2. Create new wallet
# 3. Export private key:
#    - Settings → Security → Reveal Private Key
#    - Enter password to reveal
#    - Format: 0x followed by 64 hex characters
#    - Example: 0x1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef

# ===== OPTION 2: Generate Wallet with CLI =====
# Command: npx viem-wallet-create
# OR: npm install -g @wallet-generator/cli && wallet-gen
# This generates wallet + private key + address

# ===== OPTION 3: Use Testnet Wallet for Development =====
# Get testnet ETH from: https://faucets.quicknode.com/ethereum/base
# Use Base Sepolia testnet for safe testing

ERC8004_PRIVATE_KEY="0x1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef"


# =============================================================================
# X402 PAYMENTS (Agent-Native Crypto Payments)
# x402 Facilitator API Key (OPTIONAL - only for production facilitators requiring auth)
# Development: Leave unset to use public facilitator without authentication
# Production: Add only if your facilitator requires API key authentication
# How to get (if needed):
# 1. Go to: https://x402.org
# 2. Sign up for facilitator account
# 3. Navigate to: Dashboard → API Keys
# 4. Click "Generate New Key"
# 5. Copy the API key

X402_FACILITATOR_API_KEY=""  # Leave empty for development

# x402 Facilitator Service URL
# How to get:
# - Official facilitator: https://api.x402.org (Use this for dev)
# - Self-hosted: Deploy from https://github.com/coinbase/x402
# - Cloudflare: https://developers.cloudflare.com/x402

X402_FACILITATOR_URL="https://api.x402.org"


# =============================================================================
# BASE NETWORK RPC (Ethereum L2 for USDC/x402)
# =============================================================================

# Base Mainnet RPC URL (for production)
# How to get:

# ===== OPTION 1: Public RPC (Free, rate limited) =====
# URL: https://mainnet.base.org
# Rate limit: ~100 req/min
# Good for: Development, testing
# Documentation: https://docs.base.org/base-node

# ===== OPTION 2: Infura (Requires API key, higher limits) =====
# 1. Go to: https://infura.io
# 2. Sign up and create project
# 3. Dashboard → New API Key
# 4. Select "Base" network from dropdown
# 5. RPC URL: https://base-mainnet.infura.io/v3/YOUR_API_KEY
# Free tier: 100K requests/day

# ===== OPTION 3: Alchemy (Requires API key, excellent for Web3) =====
# 1. Go to: https://www.alchemy.com
# 2. Sign up and create app
# 3. Name: "SkillsMarket-Base"
# 4. Select "Base" → "Mainnet"
# 5. RPC URL: https://base-mainnet.g.alchemy.com/v2/YOUR_API_KEY
# Free tier: 300M compute units/month

# ===== OPTION 4: QuickNode (Enterprise grade) =====
# 1. Go to: https://www.quicknode.com
# 2. Create endpoint → Select "Base"
# 3. Copy RPC URL

BASE_RPC_URL="https://mainnet.base.org"

# Base Sepolia Testnet RPC URL (for development/testing)
# How to get:
# Use same providers above with "Sepolia" network:
# - Public: https://sepolia.base.org
# - Infura: https://base-sepolia.infura.io/v3/YOUR_API_KEY
# - Alchemy: https://base-sepolia.g.alchemy.com/v2/YOUR_API_KEY

# Get testnet ETH from: https://sepoliafaucet.com
BASE_SEPOLIA_RPC_URL="https://sepolia.base.org"


# =============================================================================
# OPTIONAL: ADVANCED CONFIGURATION
# =============================================================================

# Application URL (for webhooks, redirects)
# How to set:
# ===== Local Development with ngrok =====
# 1. Install ngrok: brew install ngrok (Mac) / choco install ngrok (Windows) / snap install ngrok (Linux)
# 2. Run: ngrok http 3000
# 3. Copy HTTPS URL: https://abc123.ngrok.io
# 4. Use this for Polar webhooks in development
# 5. Note: URL changes each time you restart ngrok

# ===== Production =====
# Use your actual domain: https://your-domain.com
NEXT_PUBLIC_APP_URL="http://localhost:3000"

# Node Environment
NODE_ENV="development"

# Log Level
LOG_LEVEL="development"


# =============================================================================
# QUICK START SEQUENCE
# =============================================================================

# Step 1: Generate secrets
#   openssl rand -base64 32        → Copy to AUTH_SECRET
#   openssl rand -hex 16          → Copy to LICENSE_SALT

# Step 2: Get Polar tokens
#   Visit: https://polar.sh/dashboard → Settings → API Keys
#   Copy: POLAR_ACCESS_TOKEN
#   Visit: https://polar.sh/dashboard → Settings → Webhooks
#   Create webhook → Copy: POLAR_WEBHOOK_SECRET

# Step 3: Get x402 key
#   Visit: https://x402.org → Sign up → API Keys
#   Copy: X402_FACILITATOR_API_KEY

# Step 4: Create wallet (for ERC-8004)
#   Install MetaMask → Create wallet → Export private key
#   Copy: ERC8004_PRIVATE_KEY

# Step 5: Start development
#   npm run dev:background    # Starts server in background with logging
#   npm run dev:logs          # View server logs
#   npm run dev:stop          # Stop background server

# Step 6: Test payments (Optional)
#   ngrok http 3000           # Get HTTPS URL
#   Update Polar webhook to ngrok URL
#   Test payment flow


# =============================================================================
# LOCALHOST DEVELOPMENT WEBHOOK TESTING
# =============================================================================

# Problem: Polar needs HTTPS webhook URL, localhost doesn't work
# Solution: Use tunneling service

# ===== OPTION 1: ngrok (Easiest) =====
# Install: brew install ngrok (Mac)
# Run: ngrok http 3000
# Output: https://abc123.ngrok.io
# Use: Set Polar webhook to https://abc123.ngrok.io/api/payments/polar/webhook
# Free tier: 1 connection, changes URL on restart
# Pro: Custom domains, static URLs

# ===== OPTION 2: localtunnel =====
# Install: npm install -g localtunnel
# Run: lt --port 3000 --subdomain myapp
# Output: https://myapp.localtunnel.me
# Free: Basic tunneling

# ===== OPTION 3: Vercel Preview =====
# Deploy preview branch → Get preview URL
# Use preview URL for testing webhooks
# Free: Unlimited previews


# =============================================================================
# PRODUCTION DEPLOYMENT
# =============================================================================

# ===== Vercel (Recommended) =====
# 1. Go to: Project → Settings → Environment Variables
# 2. Add each variable:
#    - DATABASE_URL
#    - AUTH_SECRET
#    - POLAR_ACCESS_TOKEN
#    - POLAR_WEBHOOK_SECRET
#    - POLAR_MODE (set to "production")
#    - LICENSE_SALT
#    - ERC8004_PRIVATE_KEY
#    - X402_FACILITATOR_API_KEY
#    - BASE_RPC_URL (or mainnet Infura/Alchemy URL)
#    - BASE_SEPOLIA_RPC_URL
# 3. Set environment: Production
# 4. Deploy: Vercel → Redeploy

# ===== Railway =====
# 1. Project → Variables → Add Variable
# 2. Same variables as Vercel
# 3. Set DATABASE_URL (Railway provides managed DB)
# 4. Redeploy

# ===== Docker =====
# docker-compose.yml:
#   version: '3.8'
#   services:
#     app:
#       environment:
#         - DATABASE_URL=${DATABASE_URL}
#         - AUTH_SECRET=${AUTH_SECRET}
#         - POLAR_ACCESS_TOKEN=${POLAR_ACCESS_TOKEN}
#         - ... other variables
#   Run: docker-compose up


# =============================================================================
# SECURITY BEST PRACTICES
# =============================================================================

# 1. NEVER commit .env or .env.local to Git
# 2. Use .env.local for development (already in .gitignore)
# 3. Use environment variables in production (not .env files)
# 4. Rotate secrets every 90 days
# 5. Use separate wallets for testnet/mainnet
# 6. Never share private keys on Discord, Slack, GitHub
# 7. Use role-based access (CI/CD, staging, prod)
# 8. Audit access logs regularly


# =============================================================================
# NEED HELP?
# =============================================================================

# Prisma Database:    https://pris.ly/d/connection-strings
# Better Auth:         https://www.better-auth.com/docs
# Polar:               https://polar.sh/docs/integrate
# x402:                 https://x402.org/docs
# ERC-8004:          https://eips.ethereum.org/EIPS/eip-8004
# Base Network:         https://docs.base.org
# Infura:            https://infura.io/docs
# Alchemy:            https://www.alchemy.com/docs
# MetaMask:          https://support.metamask.io
